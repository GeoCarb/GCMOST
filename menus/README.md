# Menu options for GC MOST
### by Jeff Nivitanont

## Date


```python
##/--DATE--/
year = 2007 #Default 2007
month = 6
day = 21 #Default is 21 for equinoxes and solstices.
```

The most important setting in the menu. The date is required for calculations involving solar position, which feeds into all subsequent calculations needed to generate the scanning strategy. Currently, the **pre-packaged data only includes MODIS albedo data from 2007 for each month on the 21st day**. The date parameters should be type `int` and should not contain leading zeros.

## Optional Files


```python
##/--OPTIONAL FILE POINTERS--/
modisAlbedo = None 
saveDirectory = None 
scanBlockGeoms = None 
timewindowFile = None  
afwindowFile = None  
areaOfInterestFile = None 
reservedScanBlocksFile = None 
cloudProbabilityMapFile = None 
```

All file pointers should be in python string format (i.e.,`'pointer'`, `"pointer"`). All optional file pointers default to `None`.
* `modisAlbedo`: `netcdf4` or `hdf5` file containing MODIS albedo gridded at 0.5 deg lat/lon. File should have a variable `wsa_band6` referring to white sky albedo from MODIS band 6 (1.61 micron), and the variable shape should be (31, 360, 720) = (day, lat, lon). The pre-packaged data contains only 1 day per month for the year 2007.
* `saveDirectory`: directory pointer for output files to be saved. If None, then defaults to `./output`.
* `scanBlockGeoms`: netcdf4 or hdf5 file containing geometries for scan blocks. Scan blocks should be named by centroid lat/lon coordinates, and each scan block should have `['latitude_centre', 'longitude_centre']` fields for footprints within the scan block. 
* `timewindowFile`: `.pkl` file generated by MOST that lists the time of usable daylight in 5-min increments. If None, MOST will generate one for the appropriate date and save it to `saveDirectory`
* `afwindowFile`: `.pkl` file generated by MOST that contains airmass factor information for each 5-min interval in `timewindowFile`. If None, MOST will generate one for the appropriate date and save it to `saveDirectory`. Having a pregenerated `afwindowFile` saves approximately 1-4 mins depending on parallel computing capabilities. If `timewindowFile` is not provided, this will be recalculated.
* `areaOfInterestFile`: `geopandas.GeoDataFrame` containing geometries for areas of high interest for the scan. These areas will be given high priority when they are near optimal airmass.
* `reservedScanBlocksFile`: `geopandas.GeoDataFrame` containing scan block names, reservation times, and geometries. The columns of this file should have the fields `['centroid_lat_lon', 'time', 'geometry']`. 
* `cloudProbabilityMapFile`: `numpy.array` with shape `(360, 720)` to mirror the MODIS albedo file set on a 0.5deg lat/lon grid. It's entries should be between 0 and 1 inclusive, to indicate the probability of clouds within the grid cell.


```python
##/--COMPUTING OPTIONS--/
enableParallel = True
forceCalcs = False 
trimUniverseSet = True  
```

* `enableParallel`: `True/False` switch for parallel calculations for the airmass grid calculation. Default is `True`. Airmass grid calculation on a single 2.5Ghz CPU takes ~7-10mins.
* `forceCalcs`: `True/False` switch to force calculations for usable daylight and airmass grid, regardless of whether files pointers are provided. Default is `False`, though it is recommended to be `True` when debugging.
* `trimUniverseSet`: `True/False` switch for trimming the areas of N. Am and S. America that aren't covered by the provided scan blocks. Default is `True`. This gets rid of islands and small land masses not covered by scan blocks. User should check to make sure that provided scan blocks cover most of the area of interest.


```python
##/--SCANNING OPTIONS--/
scanExtraTime = True 
scanStartRefCoords = (0, -50) 
scanEndRefCoords = (19.5, -99.25)
scanStartAirmassThreshold = 3.0
scanEndAirmassThreshold = 5.0
weightDistPenalty = 1.0
weightOverlapPenalty = 1.0
distanceThreshold = 7  
universeCoverageTol = 0.002 
```

* `scanExtraTime`: `True/False` switch that determines whether the algorithm should stop after fully covering the scanning field of view (`False`) or continue scanning until the time of usable daylight runs outs (`True`). Defaults to `True`.
* `scanStartRefCoords`: `tuple(lat, lon)` to indicate which geographic point of reference to use to determine the start of the usable daylight window. Default is Macapa, BR `(0,-50)`.
* `scanEndRefCoords`: `tuple(lat, lon)` to indicate which geographic point of reference to use to determine the end of the usable daylight window. Default is Mexico City, MX `(19.5,-99.25)`.
> These two locations were chosen as points that were representative of the middle of N. and S. America. They are relatively close to the equator so their sun position is stable throughout the year.
* `scanStartAirmassThreshold`: `float` indicates at what airmass, given the start reference point,  should the usable daylight window begin. Default is `3.0`. 
* `scanEndAirmassThreshold`: `float` indicates at what airmass, given the end reference point,  should the usable daylight window end. Default is `5.0`. 
> Airmass factor is a measure of how much air a photon must travel in the Sun-Earth-satellite path. $Airmass factor = \frac{1}{SolarZenithAngle} + \frac{1}{SatelliteZenithAngle}$. 
* `weightDistPenalty`: `float` indicates how much weight is given to the distance penalty of a candidate block to the last selected block. Higher penalty results in tighter scan patterns, and vice versa. Default is `1.0`.
* `weightOverlapPenalty`: `float` indicates how much weight is given to the overlap penalty of a candidate block with the covered area. Higher penalty results in more overlapping patterns, and vice versa. Default is `1.0`.
* `distanceThreshold`: `int` indicates how many 5-min scan blocks in the E-W direction of the last selected block to consider per algorithm step. The distance from the centroid of the last selected block to the farthest candidate is used to defined a cutoff radius for other candidate scan blocks whose centroids lie outside the resulting circle. Higher number results in slower runtime. Default is `7`.
* `universeCoverageTol`: `float` is the amount of the satellite field of view that can be leftover when the program stops. Default is `0.002`


```python
##/--PLOTTING OPTIONS--/
plotCoverset = True
createMov = True
compareToBaseline = True 
```

* `plotCoverset`: `True/False` switch for plotting results and saving to `saveDirectory`. Default is `True`.
* `createMov`: `True/False` switch for creating a `.mov` file of the resulting scanning strategy. Default is `True`.
* `compareToBaseline`: `True/False` switch for comparing to a baseline strategy given in Nivitanont et al. 2019. The resulting plot gives histograms of xco2_uncert, signal-to-noise ratio, solar zenith angle, and satellite zenith angle. Default is `True`.
> Note: `compareToBaseline` function is still in beta testing. Please report any bugs found.
